\chapter{Functionality of the VO Pipeline}
The monocular visual odometry (VO) pipeline can be run with the file main.m. Its functionality is summarized by the following: The loading of the data set (main.m), the bootstrapping of initial key points (initializePointCloudMono.m) and processing of subsequent frames (processFrame.m). Finally, multiple views are corrected using bundle adjustment methods. If the ground truth is given a final alignment (achieved through scaling, rotation and translation) can be performed to judge the deviation from the reference. These last two points are further described in chapter 3.  

\section{Data Set and Parameter Settings}
Before running three parameters can be set in 'main.m' choosing the data set and whether or not bundle adjusted and/or trajectory alignment to the ground truth should be used. The last two are controlled with variables align\_to\_ground\_truth and bundle\_adjustment while the first chooses between the KITTI (ds = 0), Malaga (ds = 1), parking (ds = 2) or our own (ds = 3) data set. For more information on our own data set see chapter 3.

\section{Bootstrapping}
To initialize the pipeline point cloud must be triangulated between two key frames (frame 1 and 3) and the respective camera homographies must be found. Using the Harris corner detector, key points are found in both images and matched (using the SSD of descriptor patches). In the following step the camera homography of frame 3 is found by calculating the essential matrix (since K is known) using the eight point algorithm [ref]. To arrive at a robust estimate RANSAC is performed with a reprojection error tolerance of ?? and 1200 iterations. The final landmarks and pose were calculated with all the inliers.      

\section{Frame Processing}
As subsequent frames are processed in a Markovian fashion, meaning that information from the previous frame is sufficient to compute all necessary variables of the subsequent frame. \par
When processing a new frame, first key points (matched with landmarks) are tracked from the previous image to the next image using a KLT tracker [ref] implemented by MATLAB. Due to the large displacement of key points across images 3 pyramidal levels and a patch size of 31 x 31 pixels are used. \par
In the second step the new camera homography is computed using the new 2D-3D correspondence from the tracked key points. This can be efficiently computed using a MATLAB function. This function uses the P3P algorithm in combination with the M-estimator sample consensus (MSAC) to remove outliers. Using only three points allows few iterations to achieve high confidence (??\%). Non-tracked and outlier key points are removed with their corresponding landmarks.\par
Next new landmarks are triangulated from candidate key points which were tracked over several steps. Triangulation is performed between the track end and start. This means every track start and the corresponding homographies are saved. New landmarks are triangulated asynchronously and only if the angle between the bearing vectors at the track start and end exceeds ??. Candidate tracks are removed if they cannot be tracked and landmarks are removed if their reprojection error exceeds ?? pixels or are triangulated behind the camera.\par
This candidate loss through tracking and triangulation means new candidates must be added continuously. ?? new candidates are added at each frame using a Harris corner detector and capped at ??. To achieve a more robust behaviour certain areas of the image are suppressed before Harris corners are extracted. More information can be found in chapter 3.  
